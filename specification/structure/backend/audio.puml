@startuml ClassDiagramAudio

skinparam linetype ortho

class FFMPEGWrapper {
    audio_content_path: Path
    converters: list[AudioConverter]
    cleanup: bool

    add_converter(converter: AudioConverter): Self
    convert_song(song: bytes | BytesIO | UploadedFile): SongRepresentation
    input_file_args(song_path: Path): list[str]
    output_type_args(): list[str]
    mpd_path(song_uuid: UUID, song_content_path: Path): str
    converter_args(): list[str]
    _prepare_content_dir(song_uuid: UUID): Path
    _prepare_song_file(song, song_content_path: Path): Path
    _cleanup(song_content_path: Path): void
}

class AudioConverter {
    encoder: str
    protocol: str
    bitrates: list[int]
    extras: list[str]

    set_bitrates(bitrates: list[int]): Self
    set_extras(extras: list[str]): Self
    construct_ffmpeg_command(channel_input: int): list[list[str]]
}

FFMPEGWrapper ..> AudioConverter : <<uses>>
FFMPEGWrapper --> SongRepresentation: <<outputs>>

class SongRepresentation {
    song_content_path: Path
    manifests: dict[str, str]
    uuid_: UUID
}

class AAC_CONVERTER <<instance of AudioConverter>>
class OPUS_CONVERTER <<instance of AudioConverter>>
class AACHEv2_CONVERTER <<instance of AudioConverter>>

'AAC_CONVERTER -[hidden]-> AudioConverter
'OPUS_CONVERTER -[hidden]-> AudioConverter
'AACHEv2_CONVERTER -[hidden]-> AudioConverter

@enduml